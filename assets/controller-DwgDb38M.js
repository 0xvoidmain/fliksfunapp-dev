const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-DvEman69.js","assets/index-Atmi8JGg.js","assets/index-Q7zLqut_.css"])))=>i.map(i=>d[i]);
import{g as W,b as E,N as S,d as I,f,s as $,_ as F,D as z,i as y,j as G,k as P,l as V,m as T,U as J,S as K,p as X,o as Y,v as B,q as Q,t as Z,u as H,n as v,w as x}from"./index-Atmi8JGg.js";let w=null;const _={lastUsedChainId:"tw.wc.lastUsedChainId",requestedChains:"tw.wc.requestedChains"};async function rn(n,s,t,a,i){const c=await R(n,t,i),o=n.walletConnect;let{onDisplayUri:e}=o||{};const r=await E(t);!e&&i&&(e=U=>{const D=r.mobile.native||r.mobile.universal;if(!D){i(U);return}const k=G(D,U).redirect;i(k)}),e&&c.events.addListener("display_uri",e);let d=o?.optionalChains,l=n.chain;t==="global.safe"&&(d=O.map(f),l&&!d.includes(l)&&(l=void 0));const{chains:h,rpcMap:p}=sn({chain:l,client:n.client,optionalChains:d});await c.connect({...o?.pairingTopic?{pairingTopic:o?.pairingTopic}:{},optionalNamespaces:{[S]:{chains:h,events:["chainChanged","accountsChanged"],methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain"],rpcMap:p}}}),M(h.map(g=>Number(g.split(":")[1])),a);const u=h[0]?.split(":")[1]||1,m=I(u),A=an(c.session,"eip155:1");if(!A)throw new Error("No accounts found on provider.");const j=n.chain&&n.chain.id===m?n.chain:f(m);if(n){const g={chain:n.chain,optionalChains:n.walletConnect?.optionalChains,pairingTopic:n.walletConnect?.pairingTopic};a&&$(a,t,g)}return e&&c.events.removeListener("display_uri",e),L(A,j,c,s,a,n.client,r,i)}async function nn(n,s,t){if(!n.session)throw new Error("No session found on provider.");const a=`eip155:${s.id}`,i=v(s.id);if(q(n.session,a)){n.setDefaultChain(a);return}try{await C({provider:n,payload:{method:"wallet_switchEthereumChain",params:[{chainId:i}]},chain:a,walletInfo:t}),n.setDefaultChain(a);return}catch(o){if((o?.code??o?.data?.originalError?.code)===4001)throw new Error("User rejected chain switch")}const c=en(n.session);if(!c)throw new Error("No routable chain to send wallet_addEthereumChain");try{await C({provider:n,payload:{method:"wallet_addEthereumChain",params:[{chainId:i,chainName:s.name,nativeCurrency:s.nativeCurrency,rpcUrls:[s.rpc],blockExplorerUrls:[s.blockExplorers?.[0]?.url??""]}]},chain:c,walletInfo:t})}catch(o){throw(o?.code??o?.data?.originalError?.code)===4001?new Error("User rejected add chain"):new Error(`Add chain failed: ${o?.message||String(o)}`)}if(await C({provider:n,payload:{method:"wallet_switchEthereumChain",params:[{chainId:i}]},chain:a,walletInfo:t}),n.setDefaultChain(a),!q(n.session,a))throw new Error("Target chain still not enabled by wallet")}function b(n){return n?.namespaces?.eip155}function q(n,s){return!!b(n)?.accounts?.some(a=>a.startsWith(`${s}:`))}function an(n,s){const a=b(n)?.accounts?.find(i=>i.startsWith(`${s}:`));return a?a.split(":")[2]??null:null}function en(n){return b(n)?.accounts?.[0]?.split(":")?.slice(0,2)?.join(":")??null}async function dn(n,s,t,a,i){const c=a?await W(a,t):null,o=await E(t),e=await R(c?{chain:c.chain,client:n.client,walletConnect:{optionalChains:c.optionalChains,pairingTopic:c.pairingTopic}}:{client:n.client,walletConnect:{}},t,i);if(!e.session)throw await e.disconnect(),new Error("No wallet connect session found on provider.");const d=e.session?.namespaces?.[S]?.accounts?.[0]?.split(":")[2];if(!d)throw new Error("No accounts found on provider.");const l=n.chain?.id||1,h=I(l),p=n.chain&&n.chain.id===h?n.chain:f(h);return L(d,p,e,s,a,n.client,o,i)}async function R(n,s,t){if(w)return w;const a=await E(s),i=n.walletConnect,{UniversalProvider:c}=await F(async()=>{const{UniversalProvider:d}=await import("./index.es-DvEman69.js");return{UniversalProvider:d}},__vite__mapDeps([0,1,2]));let o=i?.optionalChains,e=n.chain;s==="global.safe"&&(o=O.map(f),e&&!o.includes(e)&&(e=void 0));const r=await c.init({metadata:{description:i?.appMetadata?.description||y().description,icons:[i?.appMetadata?.logoUrl||y().logoUrl],name:i?.appMetadata?.name||y().name,url:i?.appMetadata?.url||y().url,redirect:{native:a.mobile.native||void 0,universal:a.mobile.universal||void 0}},projectId:i?.projectId||z});if(r.events.setMaxListeners(Number.POSITIVE_INFINITY),s!=="walletConnect"){async function d(){const l=r.session?.peer?.metadata?.redirect?.native||a.mobile.native||a.mobile.universal;t&&l&&await t(l)}r.on("session_request_sent",d),r.events.addListener("disconnect",()=>{r.off("session_request_sent",d),w=null})}return w=r,r}function N({provider:n,address:s,client:t,chain:a,sessionRequestHandler:i,walletInfo:c}){return{address:T(s),async sendTransaction(e){const r=await C({provider:n,payload:{method:"eth_sendTransaction",params:[{data:e.data,from:T(s),gas:e.gas?v(e.gas):void 0,to:e.to,value:e.value?v(e.value):void 0}]},chain:`eip155:${e.chainId}`,walletInfo:c,sessionRequestHandler:i});return x({chainId:e.chainId,client:t,contractAddress:e.to??void 0,gasPrice:e.gasPrice,transactionHash:r,walletAddress:T(s),walletType:"walletConnect"}),{transactionHash:r}},async signMessage({message:e}){const r=typeof e=="string"?Z(e):e.raw instanceof Uint8Array?H(e.raw):e.raw;return C({provider:n,payload:{method:"personal_sign",params:[r,this.address]},chain:`eip155:${a.id}`,walletInfo:c,sessionRequestHandler:i})},async signTypedData(e){const r=X(e),{domain:d,message:l,primaryType:h}=r,p={EIP712Domain:Y({domain:d}),...r.types};B({domain:d,message:l,primaryType:h,types:p});const u=Q({domain:d??{},message:l,primaryType:h,types:p});return await C({provider:n,payload:{method:"eth_signTypedData_v4",params:[this.address,u]},chain:`eip155:${a.id}`,walletInfo:c,sessionRequestHandler:i})}}}async function C(n){const{provider:s,payload:t,chain:a,walletInfo:i,sessionRequestHandler:c}=n,o=s.request(t,a),e=s.session?.peer?.metadata?.redirect?.native||i.mobile.native||i.mobile.universal;return c&&e&&await c(e),o}function L(n,s,t,a,i,c,o,e){const r=N({address:n,chain:s,client:c,provider:t,sessionRequestHandler:e,walletInfo:o});async function d(){t.removeListener("accountsChanged",h),t.removeListener("chainChanged",p),t.removeListener("disconnect",l),await t.disconnect(),w=null}function l(){M([],i),i?.removeItem(_.lastUsedChainId),d(),a.emit("disconnect",void 0)}function h(u){if(u[0]){const m=N({address:T(u[0]),chain:s,client:c,provider:t,sessionRequestHandler:e,walletInfo:o});a.emit("accountChanged",m),a.emit("accountsChanged",u)}else l()}function p(u){const m=f(I(u));a.emit("chainChanged",m),i?.setItem(_.lastUsedChainId,String(u))}return t.on("accountsChanged",h),t.on("chainChanged",p),t.on("disconnect",l),t.on("session_delete",l),[r,s,d,u=>tn(t,u,o)]}async function tn(n,s,t){try{await nn(n,s,t)}catch(a){const i=typeof a=="string"?a:a?.message;throw/user rejected request/i.test(i)?new J(a):new K(a)}}function M(n,s){s?.setItem(_.requestedChains,V(n))}function sn(n){const s={},t=[];n.chain&&(s[n.chain.id]=P({chain:n.chain,client:n.client}),t.push(n.chain.id));const a=(n?.optionalChains||[]).slice(0,10);for(const i of a)s[i.id]=P({chain:i,client:n.client}),t.push(i.id);return t.includes(1)||(s[1]=f(1).rpc,t.push(1)),{chains:t.map(i=>`eip155:${i}`),rpcMap:s}}const O=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{dn as autoConnectWC,rn as connectWC};
