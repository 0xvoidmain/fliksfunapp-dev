import{e as G}from"./eth_sendRawTransaction-DPdnXbFR.js";import{u as w,ay as c,az as B,av as l,m as D,aA as z,r as u,aB as E,e as A,aC as v}from"./index-MmD_uyqy.js";import{concatHex as S}from"./concat-hex-1s7CnuQ5.js";function P(a){if(["string","number"].includes(typeof a)&&!Number.isInteger(Number(a)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${a} of type ${typeof a}`);return a instanceof Uint8Array?BigInt(w(a)):BigInt(a)}const x=(a,e)=>typeof a=="bigint"?e(a):Array.isArray(a)?a.map(t=>x(t,e)):a&&typeof a=="object"?Object.fromEntries(Object.entries(a).map(([t,n])=>[t,x(n,e)])):a,b=50000n,H=a=>{const e=L(a);return{domain:{chainId:a.chainId,name:"zkSync",version:"2"},message:e,primaryType:"Transaction",types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]}}};function L(a){const{gas:e,nonce:t,to:n,from:r,value:s,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:m,paymasterInput:y,gasPerPubdata:p,data:d,factoryDeps:f}=a;return{data:d||"0x0",factoryDeps:f?.map(g=>c(B(g)))??[],from:BigInt(r),gasLimit:e??0n,gasPerPubdataByteLimit:p??b,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,nonce:t?BigInt(t):0n,paymaster:m?BigInt(m):0n,paymasterInput:y||"0x",to:n?BigInt(n):0n,txType:113n,value:s??0n}}async function O(a){const{account:e,transaction:t}=a,n=await I(a),r=await T({account:e,chainId:t.chain.id,eip712Transaction:n}),s=l(t),i=await G(s,r);return{chain:t.chain,client:t.client,transactionHash:i}}async function T(a){const{account:e,eip712Transaction:t,chainId:n}=a,r=H(t),s=await e.signTypedData({...r});return k({...t,chainId:n,customSignature:s})}async function I(a){const{account:e,transaction:t}=a,{gas:n,maxFeePerGas:r,maxPriorityFeePerGas:s,gasPerPubdata:i}=await F({from:D(e.address),transaction:t});return{...await z({from:e.address,transaction:{...t,gas:n,maxFeePerGas:r,maxPriorityFeePerGas:s}}),...t.eip712,from:e.address,gasPerPubdata:i}}function k(a){const{chainId:e,gas:t,nonce:n,to:r,from:s,value:i,maxFeePerGas:o,maxPriorityFeePerGas:m,customSignature:y,factoryDeps:p,paymaster:d,paymasterInput:f,gasPerPubdata:g,data:h}=a,_=[n?c(n):"0x",m?c(m):"0x",o?c(o):"0x",t?c(t):"0x",r??"0x",i?c(i):"0x",h??"0x0",c(e),c(""),c(""),c(e),s??"0x",g?c(g):c(b),p??[],y??"0x",d&&f?[d,f]:[]];return S(["0x71",E(_)])}async function F(a){const{transaction:e,from:t}=a;let[n,r,s,i]=await Promise.all([u(e.gas),u(e.maxFeePerGas),u(e.maxPriorityFeePerGas),u(e.eip712)]),o=i?.gasPerPubdata;if(n===void 0||r===void 0||s===void 0){const m=l(e),y=await M({from:t,transaction:e}),p=await m({method:"zks_estimateFee",params:[x(y,c)]});n=P(p.gas_limit)*2n,r=P(p.max_fee_per_gas)*2n,s=P(p.max_priority_fee_per_gas)||1n,o=P(p.gas_per_pubdata_limit)*2n,o<50000n&&(o=50000n)}return{gas:n,gasPerPubdata:o,maxFeePerGas:r,maxPriorityFeePerGas:s}}async function M(a){const{transaction:e,from:t}=a,[n,r,s,i]=await Promise.all([A(e),u(e.to),u(e.value),u(e.eip712)]),o=i?.gasPerPubdata;return{data:n,eip712Meta:{...i,factoryDeps:i?.factoryDeps?.map(m=>Array.from(v(m))),gasPerPubdata:o||50000n},from:t,gasPerPubdata:o,to:r,type:"0x71",value:s}}const N=Object.freeze(Object.defineProperty({__proto__:null,getZkGasFees:F,populateEip712Transaction:I,sendEip712Transaction:O,signEip712Transaction:T},Symbol.toStringTag,{value:"Module"}));export{N as a,I as p,T as s,P as t};
